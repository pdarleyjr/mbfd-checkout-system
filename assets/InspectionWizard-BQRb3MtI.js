import{r as m,j as e,u as le}from"./index-DyV6w0vC.js";import{c as I,b as _,B as C,C as de,d as he,a as ue}from"./config-mspnhQU1.js";import{X as Q,T as J,M as G,g as P,C as me,a as K}from"./github-DEal1J8j.js";const xe=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],ge=I("check-check",xe);const pe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],fe=I("check",pe);const be=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],ye=I("chevron-left",be);const je=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],we=I("chevron-right",je);const Ne=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ve=I("gauge",Ne);const ke=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ce=I("shield",ke),Se=({item:a,status:o,hasExistingDefect:r,onStatusChange:i})=>{const[x,f]=m.useState(!1),[n,g]=m.useState("missing"),[c,p]=m.useState(""),S=typeof a=="string"?a:a.name,D=typeof a=="object"?a.expectedQuantity:void 0,w=typeof a=="object"?a.note:void 0,N=v=>{v==="present"?(i("present"),p("")):(g(v),f(!0))},O=()=>{if(!c.trim()){alert("Please enter notes describing the issue");return}i(n,c),f(!1),p("")},$=()=>{f(!1),p("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:_("flex items-center justify-between p-4 rounded-2xl transition-all duration-200 border-2 shadow-sm",{"bg-white border-gray-200 hover:border-gray-300":o==="present"&&!r,"bg-green-50 border-green-500 shadow-green-100":o==="present"&&!r,"bg-red-50 border-red-500 shadow-red-100":o==="missing","bg-yellow-50 border-yellow-500 shadow-yellow-100":o==="damaged","bg-orange-50 border-orange-500 shadow-orange-100":r}),children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsxs("p",{className:"font-semibold text-gray-900 text-base leading-tight",children:[S,D&&e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",D,")"]})]}),w&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:w}),r&&e.jsx("span",{className:"inline-block mt-2 px-3 py-1 bg-orange-600 text-white text-xs font-bold rounded-full shadow-sm",children:"âš ï¸ Previously Reported"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>N("present"),className:_("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="present"?"bg-green-500 text-white shadow-lg scale-105 shadow-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Present/Working",children:e.jsx(fe,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>N("missing"),className:_("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="missing"?"bg-red-500 text-white shadow-lg scale-105 shadow-red-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Missing",children:e.jsx(Q,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>N("damaged"),className:_("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="damaged"?"bg-yellow-500 text-white shadow-lg scale-105 shadow-yellow-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Damaged",children:e.jsx(J,{className:"w-7 h-7 stroke-[3]"})})]})]}),e.jsx(G,{isOpen:x,onClose:$,title:`Item ${n==="missing"?"Missing":"Damaged"}: "${S}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100",children:[n==="missing"?e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-6 h-6 text-red-600"})}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0",children:e.jsx(J,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600",children:n==="missing"?"Missing Equipment":"Damaged Equipment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Please provide detailed information"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:c,onChange:v=>p(v.target.value),placeholder:"Describe the issue in detail...",rows:4,className:"w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-4 focus:ring-blue-400 focus:border-blue-500 outline-none transition-all resize-none text-base",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Provide as much detail as possible to help with resolution"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-800",children:["ðŸ“¸ ",e.jsx("strong",{children:"Photo upload coming soon!"})," For now, please include detailed descriptions in your notes."]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(C,{onClick:O,className:"flex-1 h-12 text-base font-bold rounded-xl",children:"Submit Report"}),e.jsx(C,{onClick:$,variant:"secondary",className:"flex-1 h-12 text-base font-bold rounded-xl",children:"Cancel"})]})]})})]})},Ie=()=>{const[a,o]=m.useState(()=>{const r=window.innerWidth,i=window.innerHeight;return{isMobile:r<768,isTablet:r>=768&&r<1024,isDesktop:r>=1024,screenWidth:r,screenHeight:i,orientation:r>i?"landscape":"portrait"}});return m.useEffect(()=>{const r=()=>{const i=window.innerWidth,x=window.innerHeight;o({isMobile:i<768,isTablet:i>=768&&i<1024,isDesktop:i>=1024,screenWidth:i,screenHeight:x,orientation:i>x?"landscape":"portrait"})};return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),a};function X(a,o){const r=()=>{if(typeof window>"u")return o;try{const n=window.localStorage.getItem(a);return n?JSON.parse(n):o}catch(n){return console.warn(`Error reading localStorage key "${a}":`,n),o}},[i,x]=m.useState(r),f=n=>{try{const g=n instanceof Function?n(i):n;x(g),typeof window<"u"&&window.localStorage.setItem(a,JSON.stringify(g))}catch(g){console.warn(`Error setting localStorage key "${a}":`,g)}};return m.useEffect(()=>{x(r())},[]),[i,f]}function $e(a,o=10){const[r,i]=X(`field_history_${a}`,[]);return{history:r,addToHistory:n=>{!n||!n.trim()||i(g=>{const c=g.filter(S=>S!==n);return[n,...c].slice(0,o)})},clearHistory:()=>{i([])}}}const _e=()=>{const a=le(),o=Ie(),[r,i]=m.useState(null),[x,f]=m.useState(null),[n,g]=m.useState(0),[c,p]=m.useState(new Map),[S,D]=m.useState(new Map),[w,N]=m.useState([]),[O,$]=m.useState(!0),[v,q]=m.useState(!1),[Y,z]=m.useState(!1),[A,Z]=m.useState(0),[R,ee]=X("mbfd_last_officer_values",{});m.useEffect(()=>{const t=sessionStorage.getItem("user");if(!t){a("/");return}const s=JSON.parse(t);i(s),te(s)},[a]);const te=async t=>{try{let s;t.apparatus.startsWith("Engine")?s="engine_checklist.json":t.apparatus==="Ladder 1"?s="ladder1_checklist.json":t.apparatus==="Ladder 3"?s="ladder3_checklist.json":t.apparatus==="Rope Inventory"?s="rope_checklist.json":s="rescue_checklist.json";const l=await(await fetch(`/mbfd-checkout-system/data/${s}`)).json();f(l);const d=new Map;l.compartments.forEach(y=>{y.items.forEach(j=>{const T=typeof j=="string"?j:j.name,F=`${y.id}:${T}`;d.set(F,{name:T,status:"present",inputType:typeof j=="object"?j.inputType:"checkbox",expectedQuantity:typeof j=="object"?j.expectedQuantity:void 0})})}),p(d),l.officerChecklist&&N(l.officerChecklist.map(y=>({...y,checked:!1,value:R[y.id]||""})));const u=await P.checkExistingDefects(t.apparatus);D(u),$(!1)}catch(s){console.error("Error loading data:",s),alert("Error loading inspection data. Please try again."),$(!1)}},se=(t,s,h,l)=>{p(d=>{const u=new Map(d),y=u.get(t);return y&&u.set(t,{...y,status:s,notes:h,photoUrl:l}),u})},re=(t,s,h)=>{N(l=>{const d=[...l];d[t]={...d[t],checked:s,value:h};const u={...R};return u[d[t].id]=h||"",ee(u),d})},ae=()=>{N(t=>t.map(s=>({...s,checked:!0,value:s.value||(s.required&&s.inputType!=="checkbox"?"N/A":s.value)})))},ne=()=>{b&&p(t=>{const s=new Map(t);return b.items.forEach(h=>{const l=typeof h=="string"?h:h.name,d=`${b.id}:${l}`,u=s.get(d);u&&s.set(d,{...u,status:"present"})}),s})},oe=async()=>{if(!(!r||!x)){q(!0);try{const t=[];c.forEach(s=>{if(s.status!=="present"){const h=x.compartments.find(l=>l.items.some(d=>(typeof d=="string"?d:d.name)===s.name));t.push({compartment:h?.title||"Unknown",item:s.name,status:s.status,notes:s.notes||"",photoUrl:s.photoUrl})}}),await P.submitChecklist({user:r,apparatus:r.apparatus,date:new Date().toISOString(),items:Array.from(c.values()),defects:t,shift:r.shift,unitNumber:r.unitNumber,officerChecklist:w});try{const s=c.size,h=Array.from(c.values()).filter(u=>u.status==="present").length;let l="rescue";r.apparatus.startsWith("Engine")?l="engine":r.apparatus.startsWith("Ladder")?l="ladder":r.apparatus==="Rope Inventory"&&(l="rope");const d=t.map(u=>({item:u.item,category:u.compartment,severity:u.status==="missing"?"critical":"high"}));await P.sendNotification({apparatus:r.apparatus,operator:r.name,checklistType:l,totalItems:s,completedItems:h,defects:d,githubIssueUrl:void 0}),console.log("Notification queued/sent successfully")}catch(s){console.error("Failed to send notification (non-critical):",s)}sessionStorage.removeItem("user"),Z(t.length),z(!0)}catch(t){console.error("Error submitting inspection:",t);let s="Error submitting inspection. Please try again.";t instanceof Error&&(t.message.includes("Failed to fetch")?s="No internet connection. Please check your connection and try again.":t.message.includes("defect submissions failed")&&(s="Some defects failed to submit. Please check your connection and try again. Partial data may have been recorded.")),alert(s)}finally{q(!1)}}},W=()=>{z(!1),a("/")};if(O)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-semibold",children:"Loading inspection checklist..."})]})});if(!r||!x)return null;const H=w.length>0,L=(H?1:0)+x.compartments.length,k=H&&n===0,ie=H?n-1:n,b=k?null:x.compartments[ie],ce=n===L-1,U=k?w.every(t=>t.inputType==="checkbox"?t.checked:t.required?t.checked&&t.value&&t.value.toString().trim()!=="":t.checked||t.value&&t.value.toString().trim()!==""):b?.items.every(t=>{const s=typeof t=="string"?t:t.name,h=`${b.id}:${s}`;return c.get(h)?.status!==void 0}),V=new Date().toLocaleDateString("en-US",{weekday:"long"}),E=x.dailySchedule?.find(t=>t.day===V),M=o.isDesktop?"max-w-7xl mx-auto":o.isTablet?"max-w-4xl px-4":"max-w-2xl px-4",B=o.isDesktop?"grid grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 pb-24",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-800 via-blue-900 to-blue-800 text-white sticky top-0 z-10 shadow-2xl",children:e.jsxs("div",{className:`${M} mx-auto ${o.isDesktop?"px-6":"px-4"} py-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:r.apparatus}),e.jsxs("p",{className:"text-sm text-blue-100",children:[r.name," â€¢ ",r.rank]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-blue-200",children:["Shift ",r.shift]}),e.jsxs("p",{className:"text-sm font-semibold",children:["Unit ",r.unitNumber]}),o.isDesktop&&e.jsx("p",{className:"text-xs text-blue-300 mt-1",children:"ðŸ–¥ï¸ Desktop Mode"})]})]}),e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:L}).map((t,s)=>e.jsx("div",{className:`h-2 flex-1 rounded-full transition-all duration-300 ${s<n?"bg-green-400":s===n?"bg-white":"bg-blue-600"}`},s))}),e.jsxs("p",{className:"text-xs text-blue-100 mt-2 text-center font-medium",children:["Step ",n+1," of ",L]})]})}),E&&E.tasks.length>0&&E.tasks[0]!=="None"&&e.jsx("div",{className:`${M} mx-auto ${o.isDesktop?"px-6":"px-4"} mt-4`,children:e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-400 rounded-2xl p-4 shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"w-6 h-6 text-amber-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-amber-900 mb-1",children:["Today's Schedule - ",V]}),e.jsx("ul",{className:"space-y-1",children:E.tasks.map((t,s)=>e.jsxs("li",{className:"text-sm text-amber-800 font-medium",children:["â€¢ ",t]},s))})]})]})})}),e.jsx("div",{className:`${M} mx-auto ${o.isDesktop?"px-6":"px-4"} py-6`,children:e.jsxs(de,{className:`shadow-2xl ${o.isDesktop?"rounded-xl":"rounded-2xl"}`,children:[e.jsx(he,{className:"bg-gradient-to-r from-gray-50 to-slate-50 border-b-2 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[k?e.jsx(Ce,{className:"w-8 h-8 text-blue-700"}):e.jsx(ve,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:k?"Officer Checklist":b?.title}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:k?"Complete all officer-specific checks":"Check all equipment in this compartment"})]})]}),e.jsxs(C,{onClick:k?ae:ne,variant:"secondary",className:"flex items-center gap-2 h-10 px-4 text-sm font-bold bg-blue-100 hover:bg-blue-200 text-blue-800",children:[e.jsx(ge,{className:"w-5 h-5"}),o.isMobile?"All OK":"Check All"]})]})}),e.jsx(ue,{className:o.isDesktop?"p-6":"p-4",children:k?e.jsx("div",{className:B,children:w.map((t,s)=>e.jsx(De,{item:t,index:s,onChange:re},t.id))}):e.jsx("div",{className:B,children:b?.items.map(t=>{const s=typeof t=="string"?t:t.name,h=`${b.id}:${s}`,l=c.get(h),d=`${b.title}:${s}`,u=S.has(d),y=typeof t=="object"?t:{name:t,inputType:"checkbox"};return e.jsx(Se,{item:y,compartmentId:b.id,status:l?.status||"present",hasExistingDefect:u,onStatusChange:(j,T,F)=>se(h,j,T,F)},h)})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-300 p-4 shadow-2xl",children:e.jsxs("div",{className:`${M} mx-auto ${o.isDesktop?"px-6":""} flex gap-3`,children:[n>0&&e.jsxs(C,{onClick:()=>g(n-1),variant:"secondary",className:"flex items-center gap-2 h-14 px-6 rounded-xl font-bold bg-gray-100 hover:bg-gray-200 text-gray-800",children:[e.jsx(ye,{className:"w-5 h-5"}),"Previous"]}),e.jsx("div",{className:"flex-1"}),ce?e.jsx(C,{onClick:oe,disabled:!U||v,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-6 h-6"}),"Complete Inspection"]})}):e.jsxs(C,{onClick:()=>g(n+1),disabled:!U,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 disabled:from-gray-400 disabled:to-gray-500",children:["Next",e.jsx(we,{className:"w-5 h-5"})]})]})}),e.jsx(G,{isOpen:Y,onClose:W,title:"Inspection Complete!",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-12 h-12 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"âœ… Inspection Submitted Successfully!"}),e.jsxs("p",{className:"text-gray-700 font-medium",children:["Your ",r?.apparatus," inspection has been recorded."]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border-2 border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-800 font-semibold",children:[e.jsx("strong",{children:"Defects Reported:"})," ",A]}),A>0&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Issues have been logged and will be reviewed by maintenance."})]}),e.jsx(C,{onClick:W,className:"w-full h-12 text-base font-bold rounded-xl bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900",children:"Return to Home"})]})})]})},De=({item:a,index:o,onChange:r})=>{const{history:i,addToHistory:x}=$e(a.id),[f,n]=m.useState(!1),g=(c,p)=>{r(o,c,p),p&&typeof p=="string"&&x(p)};return a.inputType==="checkbox"?e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-white border-2 border-gray-300 transition-all hover:border-blue-400 shadow-sm",children:[e.jsx("input",{type:"checkbox",checked:a.checked,onChange:c=>g(c.target.checked),className:"w-6 h-6 rounded-lg border-2 border-gray-400 text-blue-600 focus:ring-4 focus:ring-blue-400 cursor-pointer"}),e.jsx("label",{className:"flex-1 font-semibold text-gray-900 cursor-pointer",children:a.name})]}):e.jsxs("div",{className:"p-4 rounded-xl bg-white border-2 border-gray-300 space-y-2 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.checked,onChange:()=>g(!a.checked,a.value),className:"w-5 h-5 rounded border-2 border-gray-400 text-blue-600 cursor-pointer"}),e.jsxs("label",{className:"font-semibold text-gray-900 text-sm",children:[a.name,a.required&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:a.inputType==="number"||a.inputType==="percentage"?"number":"text",value:a.value||"",onChange:c=>g(a.checked,a.inputType==="number"?parseFloat(c.target.value)||"":c.target.value),onFocus:()=>n(!0),onBlur:()=>setTimeout(()=>n(!1),200),placeholder:a.inputType==="percentage"?"Enter %":a.inputType==="number"?"Enter number":"Enter value",className:"w-full px-3 py-3 text-base rounded-lg border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-600 outline-none bg-white text-gray-900 font-medium"}),f&&i.length>0&&a.inputType==="text"&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-40 overflow-y-auto",children:i.map((c,p)=>e.jsx("button",{onClick:()=>{g(!0,c),n(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 transition-colors text-gray-900 font-medium",children:c},p))})]})]})};export{_e as InspectionWizard};
//# sourceMappingURL=InspectionWizard-BQRb3MtI.js.map
