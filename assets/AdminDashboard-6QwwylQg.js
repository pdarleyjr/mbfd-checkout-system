import{r as l,j as e,R as Fe,u as Re}from"./index-BwmsAcBa.js";import{c as I,B as k,C as u,a as b,A as ke,f as Q}from"./config-SpKMNAbk.js";import{T as R,a as M,g as L,f as qe,u as fe,b as Pe,d as ze,e as Oe,C as G,M as Ne}from"./inventory-BKD4MvOB.js";const He=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Be=I("arrow-left",He);const Ue=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],z=I("brain",Ue);const Ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],K=I("circle-alert",Ve);const Ge=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],ee=I("circle-x",Ge);const We=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],Qe=I("clipboard-list",We);const Ke=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],ve=I("clock",Ke);const Je=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],te=I("lightbulb",Je);const Xe=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Ye=I("lock",Xe);const Ze=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],se=I("mail",Ze);const es=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],q=I("package",es);const ss=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ce=I("refresh-cw",ss);const ts=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],as=I("search",ts);const ls=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],we=I("sparkles",ls);const rs=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Se=I("trending-up",rs);const ns=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],W=I("truck",ns);const is=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11",key:"pb2vm6"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z",key:"doq5xv"}],["path",{d:"M6 13h12",key:"yf64js"}],["path",{d:"M6 17h12",key:"1jwigz"}]],cs=I("warehouse",is),os=({adminPassword:c,onCriticalAlertCount:j})=>{const[o,x]=l.useState(null),[m,w]=l.useState(!1),[n,d]=l.useState(null),[r,i]=l.useState("week"),[f,S]=l.useState("all"),t=async()=>{if(!c){d("Admin authentication required");return}w(!0),d(null);try{const a=f==="all"?void 0:f,p=await L.getAIInsights(c,r,a);x(p);const C=p.insights.filter(g=>g.toLowerCase().includes("critical")||g.toLowerCase().includes("immediate")||g.toLowerCase().includes("urgent")).length;j&&j(C)}catch(a){console.error("Error loading AI insights:",a),d(a.message||"Failed to load AI insights")}finally{w(!1)}};l.useEffect(()=>{c&&t()},[r,f,c]);const h=(a,p)=>{const C=a.toLowerCase().includes("critical")||a.toLowerCase().includes("urgent"),g=a.toLowerCase().includes("warning")||a.toLowerCase().includes("attention"),_=a.toLowerCase().includes("good")||a.toLowerCase().includes("excellent")||a.toLowerCase().includes("optimal");let A="bg-blue-50",T="border-blue-200",E="text-blue-800",D=e.jsx(M,{className:"w-5 h-5 text-blue-600"});return C?(A="bg-red-50",T="border-red-200",E="text-red-800",D=e.jsx(R,{className:"w-5 h-5 text-red-600"})):g?(A="bg-yellow-50",T="border-yellow-200",E="text-yellow-800",D=e.jsx(R,{className:"w-5 h-5 text-yellow-600"})):_&&(A="bg-green-50",T="border-green-200",E="text-green-800",D=e.jsx(M,{className:"w-5 h-5 text-green-600"})),e.jsxs("div",{className:`flex items-start gap-3 p-4 ${A} rounded-lg border ${T}`,children:[D,e.jsx("p",{className:`text-sm font-medium ${E} flex-1`,children:a})]},p)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(z,{className:"w-7 h-7 text-blue-600"}),"Fleet Insights - AI Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1 flex items-center gap-2",children:[e.jsx(we,{className:"w-4 h-4 text-purple-600"}),"Powered by Cloudflare Workers AI (Llama 3 8B)"]})]}),e.jsxs(k,{onClick:t,disabled:m,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(Ce,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"Refresh Analysis"]})]}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Analysis Timeframe"}),e.jsx("div",{className:"flex gap-2",children:[{value:"week",label:"Last Week"},{value:"month",label:"Last Month"},{value:"all",label:"All Time"}].map(({value:a,label:p})=>e.jsx("button",{onClick:()=>i(a),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${r===a?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:p},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Filter by Apparatus"}),e.jsxs("select",{value:f,onChange:a=>S(a.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"all",children:"All Apparatus"}),ke.map(a=>e.jsx("option",{value:a,children:a},a))]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(k,{onClick:t,disabled:m,className:"w-full md:w-auto flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),m?"Analyzing Fleet...":"Analyze Fleet"]})})]})}),m&&e.jsx(u,{children:e.jsx(b,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 animate-pulse",children:e.jsx(we,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"AI Analysis in Progress"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing inspection data and generating insights..."}),e.jsx("div",{className:"mt-4 w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 animate-pulse"})})]})})}),n&&!m&&e.jsx(u,{className:"border-red-300",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(R,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-red-900 mb-2",children:"Analysis Unavailable"}),e.jsx("p",{className:"text-red-700 text-sm mb-4",children:n}),n.includes("503")||n.includes("enabled")?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-800",children:[e.jsx("p",{className:"font-semibold mb-2",children:"AI service is temporarily unavailable."}),e.jsx("p",{children:"This could be due to:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Cloudflare Workers AI service maintenance"}),e.jsx("li",{children:"AI features not configured in the worker"}),e.jsx("li",{children:"Network connectivity issues"})]}),e.jsx("p",{className:"mt-3 font-medium",children:"You can still view raw data in other dashboard tabs."})]}):e.jsx(k,{onClick:t,variant:"secondary",children:"Try Again"})]})]})})}),!o&&!m&&!n&&e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(z,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Analysis Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No inspection data available for this timeframe."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try expanding the timeframe or checking other apparatus."})]})}),o&&!m&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{className:"border-blue-300 bg-gradient-to-br from-blue-50 to-purple-50",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 p-3 rounded-full",children:e.jsx(Se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Analysis Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Points"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.dataPoints})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Timeframe"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 capitalize",children:o.timeframe})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Apparatus"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:o.apparatus||"All"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Insights Found"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.insights.length})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Generated at: ",new Date(o.generatedAt).toLocaleString()]})]})]})})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-orange-600"}),"AI-Generated Insights"]}),o.insights.length>0?e.jsx("div",{className:"space-y-3",children:o.insights.map((a,p)=>h(a,p))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Fleet Operating Optimally"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"AI analysis found no issues or recommendations at this time."})]})]})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5 text-green-600"}),"Fleet Health Score"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Overall Fleet Health"}),e.jsxs("span",{className:`text-lg font-bold ${o.dataPoints>0?"text-green-600":"text-gray-500"}`,children:[o.dataPoints>0?Math.max(70,100-o.insights.length*5):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 transition-all duration-500",style:{width:`${o.dataPoints>0?Math.max(70,100-o.insights.length*5):0}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Critical"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:o.insights.filter(a=>a.toLowerCase().includes("critical")).length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:o.insights.filter(a=>a.toLowerCase().includes("warning")).length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Recommendations"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.insights.filter(a=>!a.toLowerCase().includes("critical")&&!a.toLowerCase().includes("warning")).length})]})]})]})]})})]})]})},ds=({items:c,isLoading:j,error:o,onRefresh:x})=>{const[m,w]=l.useState(""),[n,d]=l.useState("name"),[r,i]=l.useState("asc"),f=l.useMemo(()=>{let t=c;if(m){const h=m.toLowerCase();t=t.filter(a=>a.equipmentName.toLowerCase().includes(h)||a.equipmentType.toLowerCase().includes(h)||a.location?.toLowerCase().includes(h)||a.description?.toLowerCase().includes(h))}return t=[...t].sort((h,a)=>{let p=0;switch(n){case"name":p=h.equipmentName.localeCompare(a.equipmentName);break;case"quantity":p=h.quantity-a.quantity;break;case"location":p=(h.location||"").localeCompare(a.location||"");break}return r==="asc"?p:-p}),t},[c,m,n,r]),S=t=>{n===t?i(r==="asc"?"desc":"asc"):(d(t),i("asc"))};return o?e.jsx(u,{className:"border-red-300",children:e.jsxs(b,{className:"py-8 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Inventory"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:o}),e.jsx(k,{onClick:x,variant:"secondary",children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(as,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search inventory...",value:m,onChange:t=>w(t.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-base"})]}),e.jsx(k,{onClick:x,variant:"secondary",className:"flex-shrink-0 min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:j,"aria-label":"Refresh inventory",children:e.jsx(Ce,{className:`w-5 h-5 ${j?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>S("name"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="name"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Name ",n==="name"&&(r==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>S("quantity"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="quantity"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Quantity ",n==="quantity"&&(r==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>S("location"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="location"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Location ",n==="location"&&(r==="asc"?"â†‘":"â†“")]})]})]}),j?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory..."})]}):f.length===0?e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:m?"No items found":"No inventory items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:m?"Try adjusting your search terms":"Inventory list is empty"})]})}):e.jsx("div",{className:"space-y-3",children:f.map(t=>{const h=t.minQty&&t.quantity<=t.minQty;return e.jsx(u,{className:`hover:shadow-md transition-shadow ${h?"border-orange-300":""}`,children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(q,{className:`w-5 h-5 flex-shrink-0 ${h?"text-orange-600":"text-blue-600"}`}),e.jsx("h3",{className:"font-bold text-gray-900 truncate",children:t.equipmentName}),h&&e.jsx(R,{className:"w-4 h-4 text-orange-600 flex-shrink-0"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Type:"})," ",t.equipmentType]}),t.location&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Location:"})," ",t.location," (Shelf ",t.shelf,", Row ",t.row,")"]}),t.manufacturer&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Mfg:"})," ",t.manufacturer]}),t.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-2 line-clamp-2",children:t.description})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:`text-3xl font-bold ${h?"text-orange-600":"text-blue-600"}`,children:t.quantity}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:t.minQty?`Min: ${t.minQty}`:"in stock"}),h&&e.jsx("div",{className:"text-xs font-semibold text-orange-600 mt-1",children:"LOW STOCK"})]})]})})},t.id)})}),!j&&f.length>0&&e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["Showing ",f.length," of ",c.length," items"]})]})};function ae(c="pending"){const[j,o]=l.useState([]),[x,m]=l.useState(!1),[w,n]=l.useState(null),[d,r]=l.useState(0),i=l.useCallback(async()=>{m(!0),n(null);try{const t=await qe(c);o(t.tasks),r(t.count)}catch(t){const h=t instanceof Error?t.message:"Failed to load tasks";n(h),console.error("Error loading tasks:",t)}finally{m(!1)}},[c]),f=l.useCallback(async(t,h,a,p)=>{try{await fe(t,{status:"completed",chosenReplacement:h,completedBy:a,notes:p}),await i()}catch(C){throw C}},[i]),S=l.useCallback(async(t,h)=>{try{await fe(t,{status:"canceled",notes:h}),await i()}catch(a){throw a}},[i]);return l.useEffect(()=>{i()},[i]),{tasks:j,isLoading:x,error:w,count:d,refresh:i,completeTask:f,cancelTask:S}}const ms=()=>{const[c,j]=l.useState("pending"),{tasks:o,isLoading:x,error:m,completeTask:w,cancelTask:n,refresh:d}=ae(c),[r,i]=l.useState(null),f=async(t,h)=>{if(confirm(`Mark "${h}" task as completed?`)){i(t);try{await w(t,void 0,"Admin","Completed from dashboard"),alert("Task marked as completed successfully")}catch(a){alert(`Error: ${a instanceof Error?a.message:"Failed to complete task"}`)}finally{i(null)}}},S=async(t,h)=>{const a=prompt(`Cancel "${h}" task? Enter reason (optional):`);if(a!==null){i(t);try{await n(t,a||"Canceled from dashboard"),alert("Task canceled successfully")}catch(p){alert(`Error: ${p instanceof Error?p.message:"Failed to cancel task"}`)}finally{i(null)}}};return m?e.jsx(u,{className:"border-red-300",children:e.jsxs(b,{className:"py-8 text-center",children:[e.jsx(K,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Tasks"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:m}),e.jsx(k,{onClick:d,variant:"secondary",children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>j("pending"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${c==="pending"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ve,{className:"w-5 h-5"}),"Pending"]}),e.jsxs("button",{onClick:()=>j("completed"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${c==="completed"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(M,{className:"w-5 h-5"}),"Completed"]}),e.jsxs("button",{onClick:()=>j("canceled"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${c==="canceled"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ee,{className:"w-5 h-5"}),"Canceled"]})]}),x?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading tasks..."})]}):o.length===0?e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["No ",c," tasks"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:c==="pending"?"All supply tasks are up to date":`No tasks have been ${c}`})]})}):e.jsx("div",{className:"space-y-3",children:o.map(t=>e.jsx(u,{className:"hover:shadow-md transition-shadow",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:t.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${t.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:t.deficiencyType==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:t.itemName}),t.compartment&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",t.compartment]})]}),c==="pending"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ve,{className:"w-6 h-6 text-orange-600"})}),c==="completed"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(M,{className:"w-6 h-6 text-green-600"})}),c==="canceled"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ee,{className:"w-6 h-6 text-gray-600"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Created by:"})," ",t.createdBy]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Created:"})," ",Q(t.createdAt)]}),t.completedBy&&t.completedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Completed by:"})," ",t.completedBy]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Completed:"})," ",Q(t.completedAt)]})]}),t.notes&&e.jsxs("p",{className:"text-gray-700 bg-gray-50 p-2 rounded mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Notes:"})," ",t.notes]})]}),c==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(k,{onClick:()=>f(t.id,t.itemName),variant:"primary",size:"sm",className:"flex-1 min-h-[44px]",disabled:r===t.id,children:r===t.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Mark Complete"]})}),e.jsxs(k,{onClick:()=>S(t.id,t.itemName),variant:"secondary",size:"sm",className:"flex-1 min-h-[44px] bg-red-50 hover:bg-red-100 text-red-700",disabled:r===t.id,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})},t.id))}),!x&&o.length>0&&e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[o.length," ",c," task",o.length!==1?"s":""]})]})};function Ie(){const[c,j]=l.useState([]),[o,x]=l.useState(!1),[m,w]=l.useState(null),[n,d]=l.useState(null),r=l.useCallback(async()=>{x(!0),w(null);try{const i=await Pe();j(i.items),d(i.fetchedAt)}catch(i){const f=i instanceof Error?i.message:"Failed to load inventory";w(f),console.error("Error loading inventory:",i)}finally{x(!1)}},[]);return l.useEffect(()=>{r()},[r]),{items:c,isLoading:o,error:m,lastFetchedAt:n,refresh:r}}const xs=()=>{const{tasks:c,isLoading:j}=ae("pending"),{items:o,isLoading:x}=Ie(),m=j||x,w=Fe.useMemo(()=>c.map(n=>{const d=[];if(n.suggestedReplacements&&n.suggestedReplacements.length>0)return{task:n,suggestions:n.suggestedReplacements.map(i=>({...i,inStock:i.qtyOnHand>0}))};const r=n.itemName.toLowerCase();return o.forEach(i=>{const f=i.equipmentName.toLowerCase(),S=i.equipmentType.toLowerCase();let t=0;f.includes(r)||r.includes(f)?t=.8:(S.includes(r)||r.includes(S))&&(t=.6),t>0&&d.push({itemId:i.id,itemName:i.equipmentName,qtyOnHand:i.quantity,location:i.location,confidence:t,inStock:i.quantity>0})}),d.sort((i,f)=>i.inStock&&!f.inStock?-1:!i.inStock&&f.inStock?1:(f.confidence||0)-(i.confidence||0)),{task:n,suggestions:d.slice(0,3)}}),[c,o]);return m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading suggestions..."})]}):c.length===0?e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(te,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Pending Tasks"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Suggestions will appear when there are pending supply tasks"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(te,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-900 font-semibold",children:"Inventory Suggestions"}),e.jsx("p",{className:"text-sm text-blue-800 mt-1",children:"Suggested replacements from inventory for pending tasks. Match confidence and stock availability shown."})]})]})}),w.map(({task:n,suggestions:d})=>e.jsx(u,{className:"hover:shadow-md transition-shadow",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:n.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${n.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n.deficiencyType==="missing"?"Missing":"Damaged"})]}),e.jsx("h3",{className:"font-bold text-gray-900",children:n.itemName}),n.compartment&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",n.compartment]})]}),d.length===0?e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[e.jsx(K,{className:"w-6 h-6 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No matching items found in inventory"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Suggested Replacements:"}),d.map((r,i)=>e.jsx("div",{className:`p-3 rounded-lg border-2 ${r.inStock?"bg-green-50 border-green-300":"bg-gray-50 border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(q,{className:`w-4 h-4 ${r.inStock?"text-green-600":"text-gray-400"}`}),e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:r.itemName})]}),r.location&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Location: ",r.location]}),r.confidence&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Match: ",Math.round(r.confidence*100),"%"]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${r.inStock?"text-green-600":"text-gray-400"}`,children:r.qtyOnHand}),e.jsx("div",{className:`text-xs font-semibold ${r.inStock?"text-green-600":"text-gray-500"}`,children:r.inStock?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"IN STOCK"]}):"OUT OF STOCK"})]})]})},`${r.itemId}-${i}`))]}),d.some(r=>r.inStock)&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-900",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," When marking this task as complete in the Tasks tab, you can select one of these items as the replacement to automatically update inventory."]})})]})})},n.id)),e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[w.length," task",w.length!==1?"s":""," with suggestions"]})]})};function hs({inventory:c,tasks:j}){const[o,x]=l.useState(!1),[m,w]=l.useState([]),[n,d]=l.useState(!1),[r,i]=l.useState(null),[f,S]=l.useState(!1);l.useEffect(()=>{t()},[]);async function t(){d(!0),i(null);try{const g=await ze();w(g.insights)}catch(g){console.error("Failed to load insights:",g),i(g instanceof Error?g.message:"Failed to load insights")}finally{d(!1)}}async function h(){x(!0),i(null),S(!1);try{const g=await Oe({tasks:j.filter(_=>_.status==="pending"),inventory:c});g.ok?setTimeout(()=>{t()},2e3):(S(!0),i(g.message))}catch(g){console.error("Failed to generate insights:",g),i(g instanceof Error?g.message:"Failed to generate insights")}finally{x(!1)}}function a(g){try{return JSON.parse(g)}catch{return null}}const p=m.length>0?m[0]:null,C=p?a(p.insight_json):null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"AI Insights"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Automated inventory analysis and recommendations"})]}),e.jsx(k,{onClick:h,disabled:o||c.length===0,className:"min-h-[44px] whitespace-nowrap",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"âš™ï¸"}),"Generating..."]}):"ðŸ¤– Generate Insights"})]}),r&&e.jsx("div",{className:`p-4 rounded-lg ${f?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${f?"text-yellow-800":"text-red-800"}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"âš ï¸ AI Not Configured:"})," ",r,e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-1 block",children:"This is an optional feature. The system works fully without it."})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error:"})," ",r]})})}),n&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin text-4xl",children:"âš™ï¸"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading insights..."})]}),!n&&p&&C&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Generated: ",new Date(p.created_at).toLocaleString(),p.model&&e.jsxs("span",{className:"ml-2",children:["â€¢ Model: ",p.model.split("/").pop()]})]}),C.summary&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-blue-800 text-sm",children:C.summary})]}),C.recurringIssues&&C.recurringIssues.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"ðŸ”„ Recurring Issues"}),e.jsx("ul",{className:"space-y-1",children:C.recurringIssues.map((g,_)=>e.jsxs("li",{className:"text-orange-800 text-sm",children:["â€¢ ",g]},_))})]}),C.reorderSuggestions&&C.reorderSuggestions.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"ðŸ“¦ Reorder Suggestions"}),e.jsx("div",{className:"space-y-3",children:C.reorderSuggestions.map((g,_)=>e.jsx("div",{className:"bg-white rounded p-3 border border-green-100",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-900 text-sm",children:g.item}),e.jsx("p",{className:"text-green-700 text-xs mt-1",children:g.reason})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${g.urgency?.toLowerCase()==="high"?"bg-red-100 text-red-800":g.urgency?.toLowerCase()==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:g.urgency||"Normal"})]})},_))})]}),C.anomalies&&C.anomalies.length>0&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"ðŸ” Anomalies Detected"}),e.jsx("ul",{className:"space-y-1",children:C.anomalies.map((g,_)=>e.jsxs("li",{className:"text-purple-800 text-sm",children:["â€¢ ",g]},_))})]})]}),!n&&m.length===0&&!r&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¤–"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No insights generated yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:'Click "Generate Insights" to analyze your inventory'})]}),m.length>1&&e.jsxs("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200",children:[m.length," insights stored â€¢ Showing most recent"]})]})}const gs=()=>{const[c,j]=l.useState("list"),{items:o,isLoading:x,error:m,refresh:w,lastFetchedAt:n}=Ie(),{tasks:d}=ae();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage supply inventory, tasks, and suggested replacements"})]}),n&&!x&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(n).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>j("list"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${c==="list"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(q,{className:"w-5 h-5"}),"Inventory List"]}),e.jsxs("button",{onClick:()=>j("tasks"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${c==="tasks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Qe,{className:"w-5 h-5"}),"Supply Tasks"]}),e.jsxs("button",{onClick:()=>j("suggestions"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${c==="suggestions"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(te,{className:"w-5 h-5"}),"Suggestions"]}),e.jsxs("button",{onClick:()=>j("ai-insights"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${c==="ai-insights"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(z,{className:"w-5 h-5"}),"AI Insights"]})]}),e.jsxs("div",{className:"mt-6",children:[c==="list"&&e.jsx(ds,{items:o,isLoading:x,error:m,onRefresh:w}),c==="tasks"&&e.jsx(ms,{}),c==="suggestions"&&e.jsx(xs,{}),c==="ai-insights"&&e.jsx(hs,{inventory:o,tasks:d})]})]})},ys=()=>{const c=Re(),[j,o]=l.useState(!1),[x,m]=l.useState(""),[w,n]=l.useState(""),[d,r]=l.useState("fleet"),[i,f]=l.useState(new Map),[S,t]=l.useState([]),[h,a]=l.useState(null),[p,C]=l.useState([]),[g,_]=l.useState(!1),[A,T]=l.useState(null),[E,D]=l.useState(""),[J,le]=l.useState(!1),[Ae,re]=l.useState(!1),[v,P]=l.useState(null),[Le,ne]=l.useState(!1),[O,ie]=l.useState(!1),[ce,H]=l.useState(null),[oe,de]=l.useState(0),[X,me]=l.useState(null),[xe,he]=l.useState([]),[_e,ge]=l.useState(!1),$e=async s=>{ge(!0);try{const N=(await L.getInspectionLogs(30)).filter($=>$.title.includes(`[${s}]`));he(N),me(s)}catch(y){console.error("Error loading apparatus logs:",y),alert("Failed to load inspection history")}finally{ge(!1)}},pe=async()=>{if(!x.trim()){n("Please enter a password");return}L.setAdminPassword(x),localStorage.setItem("adminPassword",x);try{await Y(),o(!0),n("")}catch(s){console.error("Authentication failed:",s),s instanceof Error&&s.message.includes("Unauthorized")?n("Incorrect password. Please try again."):s instanceof Error&&s.message.includes("Failed to fetch")?n("Network error. Please check your connection and try again."):n("Authentication failed. Please try again."),L.clearAdminPassword(),localStorage.removeItem("adminPassword")}},Y=async()=>{try{_(!0);const s=await L.getAllDefects(),y=L.computeFleetStatus(s);f(y),t(s);try{const N=await L.getDailySubmissions();a(N)}catch(N){console.error("Error fetching daily submissions:",N)}try{const N=await L.analyzeLowStockItems();C(N)}catch(N){console.error("Error analyzing low stock:",N)}}catch(s){throw console.error("Error loading dashboard data:",s),s instanceof Error&&s.message.includes("Unauthorized")&&(o(!1),L.clearAdminPassword(),localStorage.removeItem("adminPassword")),s}finally{_(!1)}},Me=async()=>{if(!A||!E.trim()){alert("Please enter resolution notes");return}if(!A.issueNumber){alert("Unable to resolve: Issue number not found");return}le(!0);try{await L.resolveDefect(A.issueNumber,E,"Admin"),await Y(),T(null),D(""),re(!0),setTimeout(()=>re(!1),3e3)}catch(s){console.error("Error resolving defect:",s),s.message.includes("Unauthorized")?(alert("Session expired. Please re-enter the admin password."),o(!1),L.clearAdminPassword()):alert("Error resolving defect. Please try again.")}finally{le(!1)}},ue=async()=>{if(x){ne(!0),H(null);try{const s=await L.getEmailConfig(x);P(s)}catch(s){H(s.message||"Failed to load email configuration")}finally{ne(!1)}}},F=async s=>{if(!(!x||!v)){ie(!0),H(null);try{const y=await L.updateEmailConfig(x,s);P(y.config),alert("Email configuration updated successfully")}catch(y){H(y.message||"Failed to update email configuration")}finally{ie(!1)}}},Te=async()=>{if(x&&confirm("Send a test daily digest email now?"))try{await L.sendManualDigest(x),alert("Test digest sent successfully! Check your email.")}catch(s){alert("Failed to send test digest: "+(s.message||"Unknown error"))}};if(l.useEffect(()=>{if(!j)return;const s=setInterval(()=>{Y().catch(console.error)},12e4);return()=>clearInterval(s)},[j]),!j)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4",children:e.jsx(u,{className:"max-w-md w-full",children:e.jsxs(b,{className:"py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(Ye,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Enter the admin password to continue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:x,onChange:s=>{m(s.target.value),n("")},onKeyDown:s=>{s.key==="Enter"&&pe()},placeholder:"Enter admin password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0}),w&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:w})]}),e.jsx(k,{onClick:pe,className:"w-full",size:"lg",children:"Access Admin Dashboard"}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>c("/"),className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"â† Back to Login"})})]})]})})});if(g)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading dashboard..."})]})});const Z=ke,Ee=new Date().toLocaleDateString("en-US");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Ae&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Defect resolved successfully!"})]}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"MBFD Fleet Management System"})]}),e.jsxs(k,{onClick:()=>c("/"),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(Be,{className:"w-5 h-5"}),"Back to Login"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>r("fleet"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="fleet"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(W,{className:"w-5 h-5"}),"Fleet Status"]}),e.jsxs("button",{onClick:()=>r("activity"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="activity"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(G,{className:"w-5 h-5"}),"Daily Activity"]}),e.jsxs("button",{onClick:()=>r("supplies"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="supplies"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(q,{className:"w-5 h-5"}),"Supply Alerts",p.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:p.length})]}),e.jsxs("button",{onClick:()=>r("inventory"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="inventory"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(cs,{className:"w-5 h-5"}),"Inventory"]}),e.jsxs("button",{onClick:()=>{r("notifications"),v||ue()},className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="notifications"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(se,{className:"w-5 h-5"}),"Notifications"]}),e.jsxs("button",{onClick:()=>{r("insights"),de(0)},className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 relative ${d==="insights"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(z,{className:"w-5 h-5"}),"Fleet Insights",oe>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold",children:oe})]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[d==="fleet"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Fleet Status"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Z.map(s=>{const y=i.get(s)||0,N=y===0;return e.jsx("div",{className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>$e(s),children:e.jsx(u,{className:N?"border-green-500":"border-red-500",children:e.jsxs(b,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(W,{className:`w-8 h-8 ${N?"text-green-500":"text-red-500"}`}),N?e.jsx(M,{className:"w-6 h-6 text-green-500"}):e.jsx(K,{className:"w-6 h-6 text-red-500"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:s}),e.jsx("p",{className:`text-sm font-semibold ${N?"text-green-600":"text-red-600"}`,children:N?"âœ“ All Clear":`${y} Defect${y!==1?"s":""}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click to view history"})]})})},s)})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["Open Defects (",S.length,")"]}),S.length===0?e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(M,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Open Defects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All apparatus are fully operational"})]})}):e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsx(u,{className:"hover:shadow-md transition-shadow",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:s.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:[s.compartment,": ",s.item]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Reported by ",s.reportedBy," on ",Q(s.reportedAt)]}),s.notes&&e.jsx("p",{className:"text-gray-700 text-sm bg-gray-50 p-3 rounded-lg",children:s.notes.split(`
`).slice(0,3).join(`
`)})]}),e.jsx(k,{onClick:()=>T(s),variant:"primary",size:"sm",className:"mt-3 md:mt-0 md:ml-4",children:"Resolve"})]})})},`${s.apparatus}-${s.item}`))})]})]}),d==="activity"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-6 h-6"}),"Daily Activity - ",Ee]}),e.jsx(u,{className:"mb-6",children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Today's Submissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:Z.map(s=>{const y=h?.today.includes(s)||!1;return e.jsxs("div",{className:`p-4 rounded-lg border-2 ${y?"bg-green-50 border-green-500":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(W,{className:`w-6 h-6 ${y?"text-green-600":"text-gray-400"}`}),y?e.jsx(M,{className:"w-5 h-5 text-green-600"}):e.jsx(K,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("p",{className:"font-bold text-gray-900",children:s}),e.jsx("p",{className:`text-sm font-semibold ${y?"text-green-600":"text-gray-500"}`,children:y?"âœ“ Submitted":"Pending"})]},s)})})]})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5"}),"Submission Statistics (Last 30 Days)"]}),e.jsx("div",{className:"space-y-3",children:Z.map(s=>{const y=h?.totals.get(s)||0,N=h?.lastSubmission.get(s),$=Math.round(y/30*100);return e.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:y}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"submissions"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[$,"% compliance rate"]}),N&&e.jsxs("span",{children:["Last: ",N]})]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${$>=80?"bg-green-500":$>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min($,100)}%`}})})]},s)})})]})})]})}),d==="supplies"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-6 h-6 text-orange-600"}),"Supply Alerts"]}),p.length===0?e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Supply Concerns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All items are adequately stocked"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"Note:"})," Items listed below have been reported missing multiple times across different apparatus in the last 30 days. This may indicate a supply shortage requiring attention."]})}),p.map((s,y)=>e.jsx(u,{className:"border-orange-300",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(R,{className:"w-6 h-6 text-orange-600"}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[s.compartment,": ",s.item]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsxs("strong",{children:["Reported missing ",s.occurrences," time",s.occurrences!==1?"s":""]})," in the last 30 days"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Affected apparatus:"}),s.apparatus.map(N=>e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-semibold",children:N},N))]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full",children:e.jsx("span",{className:"text-xl font-bold text-orange-600",children:s.occurrences})})})]})})},y))]})]}),d==="inventory"&&e.jsx(gs,{}),d==="insights"&&e.jsx(e.Fragment,{children:e.jsx(os,{adminPassword:x,onCriticalAlertCount:de})}),d==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Email Notifications"}),e.jsxs(k,{onClick:Te,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5"}),"Send Test Digest"]})]}),ce&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:ce}),Le?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading configuration..."})]}):v?e.jsxs("div",{className:"space-y-6",children:[e.jsx(u,{children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:v.enabled?"Notifications are currently enabled":"Notifications are currently disabled"})]}),e.jsx(k,{onClick:()=>F({enabled:!v.enabled}),className:v.enabled?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",disabled:O,children:v.enabled?"Disable":"Enable"})]})})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Mode"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"daily_digest",checked:v.email_mode==="daily_digest",onChange:s=>F({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Daily Digest (Recommended)"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Send one summary email per day at ",v.digest_send_time]})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"per_submission",checked:v.email_mode==="per_submission",onChange:s=>F({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Per Submission"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Send an email immediately after each inspection"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"hybrid",checked:v.email_mode==="hybrid",onChange:s=>F({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Hybrid"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Immediate for critical defects, daily digest for routine"})]})]})]})]})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Recipients"}),e.jsxs("div",{className:"space-y-3",children:[v.recipients.map((s,y)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"email",value:s,onChange:N=>{const $=[...v.recipients];$[y]=N.target.value,P({...v,recipients:$})},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"email@example.com"}),e.jsx(k,{onClick:()=>{const N=v.recipients.filter(($,B)=>B!==y);F({recipients:N})},variant:"secondary",className:"bg-red-50 hover:bg-red-100 text-red-700",children:"Remove"})]},y)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{onClick:()=>{const s=[...v.recipients,""];P({...v,recipients:s})},variant:"secondary",children:"+ Add Recipient"}),e.jsx(k,{onClick:()=>F({recipients:v.recipients.filter(s=>s!=="")}),disabled:O,children:"Save Recipients"})]})]})]})}),e.jsx(u,{children:e.jsx(b,{className:"p-6",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v.enable_immediate_for_critical,onChange:s=>F({enable_immediate_for_critical:s.target.checked}),className:"mt-1 w-5 h-5 text-blue-600 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Immediate Alerts for Critical Defects"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Send immediate email when critical defects are found (only in hybrid mode)"})]})]})})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily Email Limit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"number",value:v.daily_email_hard_cap,onChange:s=>P({...v,daily_email_hard_cap:parseInt(s.target.value)||250}),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"500"}),e.jsx("span",{className:"text-gray-600",children:"emails per day (max: 500)"}),e.jsx(k,{onClick:()=>F({daily_email_hard_cap:v.daily_email_hard_cap}),disabled:O,children:"Save"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current: ",v.daily_email_hard_cap," / Recommended: 250"]})]})}),e.jsx(u,{children:e.jsxs(b,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Subject Template"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:v.email_subject_template,onChange:s=>P({...v,email_subject_template:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"MBFD Daily Inspection Summary - {date}"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Use ","{date}"," for the current date"]}),e.jsx(k,{onClick:()=>F({email_subject_template:v.email_subject_template}),disabled:O,children:"Save Template"})]})]})})]}):e.jsx(u,{children:e.jsxs(b,{className:"py-12 text-center",children:[e.jsx(se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Click the button below to load email configuration"}),e.jsx(k,{onClick:ue,children:"Load Configuration"})]})})]}),e.jsx(Ne,{isOpen:!!X,onClose:()=>{me(null),he([])},title:`${X} - Inspection History (Last 30 Days)`,children:_e?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inspection history..."})]}):xe.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(G,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Inspection History"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:["No inspections found for ",X," in the last 30 days"]})]}):e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:xe.map((s,y)=>{const N=s.title.match(/- (.+)$/),$=N?N[1]:"Unknown Date",B=s.body.match(/Total Items Checked:\*\* (\d+)/),be=s.body.match(/Issues Found:\*\* (\d+)/),De=B?parseInt(B[1]):0,U=be?parseInt(be[1]):0,ye=s.body.match(/\[View Full Printable Receipt\]\(([^)]+)\)/),je=ye?ye[1]:null,V=U>0;return e.jsx(u,{className:`${V?"border-yellow-300":"border-green-300"}`,children:e.jsxs(b,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(G,{className:"w-4 h-4 text-gray-600"}),e.jsx("p",{className:"font-semibold text-gray-900",children:$})]}),e.jsx("p",{className:"text-sm text-gray-600",children:Q(s.created_at)})]}),V?e.jsxs("span",{className:"px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-semibold",children:[U," Issue",U!==1?"s":""]}):e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-semibold flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),"All Clear"]})]}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-sm text-gray-700 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Items Checked:"}),e.jsx("span",{className:"font-semibold",children:De})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Issues Found:"}),e.jsx("span",{className:`font-semibold ${V?"text-yellow-600":"text-green-600"}`,children:U})]})]}),V&&e.jsxs("div",{className:"mt-3 bg-yellow-50 p-3 rounded-lg",children:[e.jsx("p",{className:"text-xs font-semibold text-yellow-900 mb-2",children:"Issues Reported:"}),e.jsx("div",{className:"text-xs text-yellow-800 whitespace-pre-wrap",children:s.body.split("### Issues Reported")[1]?.split("---")[0]?.trim()||"Details not available"})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-3 justify-end",children:[je&&e.jsx("a",{href:je,target:"_blank",rel:"noopener noreferrer",className:"text-sm bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-300 px-3 py-2 rounded-lg font-medium transition-colors flex items-center gap-1",children:"ðŸ“‹ View Receipt"}),e.jsx("a",{href:s.html_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"View Full Details â†’"})]})]})},s.number||y)})})}),e.jsx(Ne,{isOpen:!!A,onClose:()=>{T(null),D("")},title:"Resolve Defect",children:A&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Apparatus"}),e.jsx("p",{className:"font-semibold text-gray-900",children:A.apparatus}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Item"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[A.compartment,": ",A.item]}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Status"}),e.jsx("p",{className:"font-semibold text-gray-900",children:A.status==="missing"?"Missing":"Damaged"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Resolution Notes"}),e.jsx("textarea",{value:E,onChange:s=>D(s.target.value),placeholder:"Describe how this was resolved (e.g., 'Replaced with spare', 'Item found and returned', 'Repaired by maintenance')",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k,{onClick:Me,disabled:J||!E.trim(),className:"flex-1",children:J?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Resolving..."]}):"Mark as Resolved"}),e.jsx(k,{onClick:()=>{T(null),D("")},variant:"secondary",className:"flex-1",disabled:J,children:"Cancel"})]})]})})]})]})};export{ys as AdminDashboard};
//# sourceMappingURL=AdminDashboard-6QwwylQg.js.map
