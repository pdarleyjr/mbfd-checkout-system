import{u as Q,r,j as e}from"./index-ptIPgBaF.js";import{c as x,C as c,a as i,B as m,A as W,f as X}from"./config-DTwmxzs6.js";import{a as y,C as M,T,M as Y,g as n}from"./github-BrSo8LXn.js";import{T as j}from"./truck-5tvIIm0A.js";const Z=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ee=x("arrow-left",Z);const se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],z=x("circle-alert",se);const te=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],ae=x("lock",te);const re=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],F=x("package",re);const le=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ne=x("trending-up",le),me=()=>{const P=Q(),[f,N]=r.useState(!1),[w,_]=r.useState(""),[$,o]=r.useState(""),[d,v]=r.useState("fleet"),[B,U]=r.useState(new Map),[S,q]=r.useState([]),[k,O]=r.useState(null),[h,V]=r.useState([]),[H,R]=r.useState(!1),[l,g]=r.useState(null),[u,b]=r.useState(""),[A,E]=r.useState(!1),[K,I]=r.useState(!1),L=async()=>{if(!w.trim()){o("Please enter a password");return}n.setAdminPassword(w);try{await D(),N(!0),o("")}catch(s){console.error("Authentication failed:",s),s instanceof Error&&s.message.includes("Unauthorized")?o("Incorrect password. Please try again."):s instanceof Error&&s.message.includes("Failed to fetch")?o("Network error. Please check your connection and try again."):o("Authentication failed. Please try again."),n.clearAdminPassword()}},D=async()=>{try{R(!0);const s=await n.getAllDefects(),a=n.computeFleetStatus(s);U(a),q(s);try{const t=await n.getDailySubmissions();O(t)}catch(t){console.error("Error fetching daily submissions:",t)}try{const t=await n.analyzeLowStockItems();V(t)}catch(t){console.error("Error analyzing low stock:",t)}}catch(s){throw console.error("Error loading dashboard data:",s),s instanceof Error&&s.message.includes("Unauthorized")&&(N(!1),n.clearAdminPassword()),s}finally{R(!1)}},G=async()=>{if(!l||!u.trim()){alert("Please enter resolution notes");return}if(!l.issueNumber){alert("Unable to resolve: Issue number not found");return}E(!0);try{await n.resolveDefect(l.issueNumber,u,"Admin"),await D(),g(null),b(""),I(!0),setTimeout(()=>I(!1),3e3)}catch(s){console.error("Error resolving defect:",s),s instanceof Error&&s.message.includes("Unauthorized")?(alert("Session expired. Please re-enter the admin password."),N(!1),n.clearAdminPassword()):alert("Error resolving defect. Please try again.")}finally{E(!1)}};if(r.useEffect(()=>{if(!f)return;const s=setInterval(()=>{D().catch(console.error)},12e4);return()=>clearInterval(s)},[f]),!f)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4",children:e.jsx(c,{className:"max-w-md w-full",children:e.jsxs(i,{className:"py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(ae,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Enter the admin password to continue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:w,onChange:s=>{_(s.target.value),o("")},onKeyDown:s=>{s.key==="Enter"&&L()},placeholder:"Enter admin password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0}),$&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:$})]}),e.jsx(m,{onClick:L,className:"w-full",size:"lg",children:"Access Admin Dashboard"}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>P("/"),className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"← Back to Login"})})]})]})})});if(H)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading dashboard..."})]})});const C=W,J=new Date().toLocaleDateString("en-US");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[K&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Defect resolved successfully!"})]}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"MBFD Fleet Management System"})]}),e.jsxs(m,{onClick:()=>P("/"),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-5 h-5"}),"Back to Login"]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>v("fleet"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="fleet"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(j,{className:"w-5 h-5"}),"Fleet Status"]}),e.jsxs("button",{onClick:()=>v("activity"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="activity"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(M,{className:"w-5 h-5"}),"Daily Activity"]}),e.jsxs("button",{onClick:()=>v("supplies"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 ${d==="supplies"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(F,{className:"w-5 h-5"}),"Supply Alerts",h.length>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full",children:h.length})]})]})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[d==="fleet"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Fleet Status"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:C.map(s=>{const a=B.get(s)||0,t=a===0;return e.jsx(c,{className:t?"border-green-500":"border-red-500",children:e.jsxs(i,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(j,{className:`w-8 h-8 ${t?"text-green-500":"text-red-500"}`}),t?e.jsx(y,{className:"w-6 h-6 text-green-500"}):e.jsx(z,{className:"w-6 h-6 text-red-500"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:s}),e.jsx("p",{className:`text-sm font-semibold ${t?"text-green-600":"text-red-600"}`,children:t?"✓ All Clear":`${a} Defect${a!==1?"s":""}`})]})},s)})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["Open Defects (",S.length,")"]}),S.length===0?e.jsx(c,{children:e.jsxs(i,{className:"py-12 text-center",children:[e.jsx(y,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Open Defects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All apparatus are fully operational"})]})}):e.jsx("div",{className:"space-y-3",children:S.map(s=>e.jsx(c,{className:"hover:shadow-md transition-shadow",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:s.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status==="missing"?"❌ Missing":"⚠️ Damaged"})]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:[s.compartment,": ",s.item]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Reported by ",s.reportedBy," on ",X(s.reportedAt)]}),s.notes&&e.jsx("p",{className:"text-gray-700 text-sm bg-gray-50 p-3 rounded-lg",children:s.notes.split(`
`).slice(0,3).join(`
`)})]}),e.jsx(m,{onClick:()=>g(s),variant:"primary",size:"sm",className:"mt-3 md:mt-0 md:ml-4",children:"Resolve"})]})})},`${s.apparatus}-${s.item}`))})]})]}),d==="activity"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(M,{className:"w-6 h-6"}),"Daily Activity - ",J]}),e.jsx(c,{className:"mb-6",children:e.jsxs(i,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Today's Submissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:C.map(s=>{const a=k?.today.includes(s)||!1;return e.jsxs("div",{className:`p-4 rounded-lg border-2 ${a?"bg-green-50 border-green-500":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(j,{className:`w-6 h-6 ${a?"text-green-600":"text-gray-400"}`}),a?e.jsx(y,{className:"w-5 h-5 text-green-600"}):e.jsx(z,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("p",{className:"font-bold text-gray-900",children:s}),e.jsx("p",{className:`text-sm font-semibold ${a?"text-green-600":"text-gray-500"}`,children:a?"✓ Submitted":"Pending"})]},s)})})]})}),e.jsx(c,{children:e.jsxs(i,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5"}),"Submission Statistics (Last 30 Days)"]}),e.jsx("div",{className:"space-y-3",children:C.map(s=>{const a=k?.totals.get(s)||0,t=k?.lastSubmission.get(s),p=Math.round(a/30*100);return e.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:a}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"submissions"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[p,"% compliance rate"]}),t&&e.jsxs("span",{children:["Last: ",t]})]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${p>=80?"bg-green-500":p>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(p,100)}%`}})})]},s)})})]})})]})}),d==="supplies"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(T,{className:"w-6 h-6 text-orange-600"}),"Supply Alerts"]}),h.length===0?e.jsx(c,{children:e.jsxs(i,{className:"py-12 text-center",children:[e.jsx(F,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Supply Concerns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All items are adequately stocked"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"Note:"})," Items listed below have been reported missing multiple times across different apparatus in the last 30 days. This may indicate a supply shortage requiring attention."]})}),h.map((s,a)=>e.jsx(c,{className:"border-orange-300",children:e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(T,{className:"w-6 h-6 text-orange-600"}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[s.compartment,": ",s.item]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsxs("strong",{children:["Reported missing ",s.occurrences," time",s.occurrences!==1?"s":""]})," in the last 30 days"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Affected apparatus:"}),s.apparatus.map(t=>e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-semibold",children:t},t))]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full",children:e.jsx("span",{className:"text-xl font-bold text-orange-600",children:s.occurrences})})})]})})},a))]})]})]}),e.jsx(Y,{isOpen:!!l,onClose:()=>{g(null),b("")},title:"Resolve Defect",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Apparatus"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.apparatus}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Item"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[l.compartment,": ",l.item]}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Status"}),e.jsx("p",{className:"font-semibold text-gray-900",children:l.status==="missing"?"Missing":"Damaged"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Resolution Notes"}),e.jsx("textarea",{value:u,onChange:s=>b(s.target.value),placeholder:"Describe how this was resolved (e.g., 'Replaced with spare', 'Item found and returned', 'Repaired by maintenance')",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{onClick:G,disabled:A||!u.trim(),className:"flex-1",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Resolving..."]}):"Mark as Resolved"}),e.jsx(m,{onClick:()=>{g(null),b("")},variant:"secondary",className:"flex-1",disabled:A,children:"Cancel"})]})]})})]})};export{me as AdminDashboard};
//# sourceMappingURL=AdminDashboard-BiX-VZn-.js.map
