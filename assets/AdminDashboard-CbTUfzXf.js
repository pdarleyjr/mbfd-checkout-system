import{u as F,r as t,j as e}from"./index-CSExyLD3.js";import{c as y,C as x,a as h,B as c,A as $,f as B}from"./config-CrA28sVH.js";import{C as b,M as _,g as r}from"./github-jO65g4cw.js";import{T}from"./truck-Wt4a1rBQ.js";const U=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],O=y("arrow-left",U);const q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],H=y("circle-alert",q);const K=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],V=y("lock",K),X=()=>{const j=F(),[D,u]=t.useState(!1),[g,C]=t.useState(""),[N,l]=t.useState(""),[P,R]=t.useState(new Map),[p,E]=t.useState([]),[I,w]=t.useState(!1),[a,o]=t.useState(null),[d,m]=t.useState(""),[f,v]=t.useState(!1),[L,k]=t.useState(!1),A=async()=>{if(!g.trim()){l("Please enter a password");return}r.setAdminPassword(g);try{await S(),u(!0),l("")}catch(s){console.error("Authentication failed:",s),s instanceof Error&&s.message.includes("Unauthorized")?l("Incorrect password. Please try again."):s instanceof Error&&s.message.includes("Failed to fetch")?l("Network error. Please check your connection and try again."):l("Authentication failed. Please try again."),r.clearAdminPassword()}},S=async()=>{try{w(!0);const s=await r.getAllDefects(),n=r.computeFleetStatus(s);R(n),E(s)}catch(s){throw console.error("Error loading dashboard data:",s),s instanceof Error&&s.message.includes("Unauthorized")&&(u(!1),r.clearAdminPassword()),s}finally{w(!1)}},M=async()=>{if(!a||!d.trim()){alert("Please enter resolution notes");return}if(!a.issueNumber){alert("Unable to resolve: Issue number not found");return}v(!0);try{await r.resolveDefect(a.issueNumber,d,"Admin"),await S(),o(null),m(""),k(!0),setTimeout(()=>k(!1),3e3)}catch(s){console.error("Error resolving defect:",s),s instanceof Error&&s.message.includes("Unauthorized")?(alert("Session expired. Please re-enter the admin password."),u(!1),r.clearAdminPassword()):alert("Error resolving defect. Please try again.")}finally{v(!1)}};if(!D)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4",children:e.jsx(x,{className:"max-w-md w-full",children:e.jsxs(h,{className:"py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(V,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Enter the admin password to continue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:g,onChange:s=>{C(s.target.value),l("")},onKeyDown:s=>{s.key==="Enter"&&A()},placeholder:"Enter admin password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0}),N&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:N})]}),e.jsx(c,{onClick:A,className:"w-full",size:"lg",children:"Access Admin Dashboard"}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>j("/"),className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"← Back to Login"})})]})]})})});if(I)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading dashboard..."})]})});const z=$;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[L&&e.jsxs("div",{className:"fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:"Defect resolved successfully!"})]}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"MBFD Fleet Status & Defect Management"})]}),e.jsxs(c,{onClick:()=>j("/"),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),"Back to Login"]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Fleet Status"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:z.map(s=>{const n=P.get(s)||0,i=n===0;return e.jsx(x,{className:i?"border-green-500":"border-red-500",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(T,{className:`w-8 h-8 ${i?"text-green-500":"text-red-500"}`}),i?e.jsx(b,{className:"w-6 h-6 text-green-500"}):e.jsx(H,{className:"w-6 h-6 text-red-500"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:s}),e.jsx("p",{className:`text-sm font-semibold ${i?"text-green-600":"text-red-600"}`,children:i?"✓ All Clear":`${n} Defect${n!==1?"s":""}`})]})},s)})})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:["Open Defects (",p.length,")"]}),p.length===0?e.jsx(x,{children:e.jsxs(h,{className:"py-12 text-center",children:[e.jsx(b,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Open Defects"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All apparatus are fully operational"})]})}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx(x,{className:"hover:shadow-md transition-shadow",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:s.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${s.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:s.status==="missing"?"❌ Missing":"⚠️ Damaged"})]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:[s.compartment,": ",s.item]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Reported by ",s.reportedBy," on ",B(s.reportedAt)]}),s.notes&&e.jsx("p",{className:"text-gray-700 text-sm bg-gray-50 p-3 rounded-lg",children:s.notes.split(`
`).slice(0,3).join(`
`)})]}),e.jsx(c,{onClick:()=>o(s),variant:"primary",size:"sm",className:"mt-3 md:mt-0 md:ml-4",children:"Resolve"})]})})},`${s.apparatus}-${s.item}`))})]})]}),e.jsx(_,{isOpen:!!a,onClose:()=>{o(null),m("")},title:"Resolve Defect",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Apparatus"}),e.jsx("p",{className:"font-semibold text-gray-900",children:a.apparatus}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Item"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[a.compartment,": ",a.item]}),e.jsx("p",{className:"text-sm text-gray-600 mt-3 mb-1",children:"Status"}),e.jsx("p",{className:"font-semibold text-gray-900",children:a.status==="missing"?"Missing":"Damaged"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Resolution Notes"}),e.jsx("textarea",{value:d,onChange:s=>m(s.target.value),placeholder:"Describe how this was resolved (e.g., 'Replaced with spare', 'Item found and returned', 'Repaired by maintenance')",rows:4,className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{onClick:M,disabled:f||!d.trim(),className:"flex-1",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Resolving..."]}):"Mark as Resolved"}),e.jsx(c,{onClick:()=>{o(null),m("")},variant:"secondary",className:"flex-1",disabled:f,children:"Cancel"})]})]})})]})};export{X as AdminDashboard};
//# sourceMappingURL=AdminDashboard-CbTUfzXf.js.map
